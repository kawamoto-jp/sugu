<div class="content">
  <header>
    <div class="border">
      <%= link_to 'S U G U', root_path, class: 'title' %>
      <ul class="right_header">
      <% if user_signed_in? %>
        <li class="user_name">
        <%= current_user.nickname %>さん、まいど！
        </li>
        <li class="logout">
        <%= link_to 'ログアウト', destroy_user_session_path, method: :delete, class: 'header_btn' %>
        </li>
        <li class="new_user_info">
        <%= link_to 'マイページ', pre_page_user_infos_path, class: 'header_btn' %>
        </li>
      <% else %>
        <li class="signin">
        <%= link_to '新規登録', new_user_registration_path, class: 'header_btn' %>
        </li>
        <li class="login">
        <%= link_to 'ログイン', new_user_session_path, class: 'header_btn' %>
        </li>
      <% end %>
      </ul>
    </div>
  </header>

  <div class="top_main">
    <div class="left">
    </div>
    <div class="right">
      <div class="proportion">
        <h2>現在の男女比</h2>
        <span class="sex otoko">男 </span><span class="sex"><%= @promotion_male %> ：<span class="sex onna"> 女 </span><span class="sex"><%= @promotion_female %></span>
      </div>
      <div class="wating">
        <h2>待機中グループを検索</h2>
        <%= search_form_for @p, url: user_infos_search_path do |f| %>
        <div class="try">
        <%= f.label :area_id_eq, 'エリア' %>
        <%= f.collection_select :area_id_eq, Area.all, :id, :name, include_blank: '指定なし' %>
        </div>
        <br>
        <div class="try">
        <%= f.label :people_num_id_eq, '人数' %>
        <%= f.collection_select :people_num_id_eq, PeopleNum.all, :id, :name, include_blank: '指定なし' %>人
        </div>
        <br>
        <%= f.submit '探してみる', class: "search_btn" %>
      </div>
      <% end %>
    </div>
  </div>
</div>



<div class="search_top">
  <div class="flex">
    <h2 class="login_now">検索結果</h2>
  </div>
  <div class="root_path">
  <%= link_to 'トップページへ戻る', root_path %>
  </div>
</div>
<%# 検索結果の個数で条件分岐 %>
<div class="top_page">
  <% if @results.length != 0 %>
    <ul class="groups">
      <% @results.each do |result| %>
        <li class="list">
          <div class='user_infos'>
            <div class="user_img">
            <!-- ネットのフォローボタン  -->
            <%= image_tag result.image.variant(resize:'400x400'), class: "user_img" if result.image.attached? %>
            <% if user_signed_in? && result.user_id != current_user.id %>
              <% if result.favorited_by?(current_user) %> <!-- ログインしているユーザーがファボしたかどうかで分岐 -->
                <p class="followed_btn"><%=link_to "お気に入り済", user_info_favorite_path(result.id), class: "white", method: :delete %></p>
              <% else %>
                <p class="follow_btn"><%=link_to "お気に入り", user_info_favorites_path, class: "white", method: :post %></p>
              <% end %>
            <% end %>
            <!-- ネットのフォローボタン  -->
              <div class="top">
                <p class="nickname"><%= result.user.nickname %></p>
                <span>/</span>
                <p class="area"><%= result.area.name %></p>
                <span>/</span>
                <p class="people_num"><%= result.people_num_id %>人</p>
              </div>
              <div class="down">
                <p class="user_info_text">ひとこと：<%= result.text %></p>
              </div>
            </div>
          </div>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p class="sorry">申し訳ございません、現在該当するグループはいません。<br>違う条件でも検索してみてください。</p>
  <% end %>
</div>


